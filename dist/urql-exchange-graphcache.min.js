"use strict";var e=require("mobx"),t=require("graphql"),n=require("urql/core"),r=require("wonka");function i(){return(i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n,r=arguments[t];for(n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}var o=function(e){return e.name.value},a=function(e){return e.typeCondition.name.value},s=function(e){return void 0!==e.alias?e.alias.value:o(e)},u=function(e){return void 0!==e.selectionSet?e.selectionSet.selections:[]},c=function(e){return void 0!==(e=e.typeCondition)?o(e):null},l=function(e){return e.kind===t.Kind.FIELD},f=function(e){return e.kind===t.Kind.INLINE_FRAGMENT},d=function(e){return t.isWrappingType(e)?d(e.ofType):e||null},p="\nhttps://github.com/FormidableLabs/urql-exchange-graphcache/blob/master/docs/help.md#";function v(e,t,n){if(!e)throw(e=Error((t||"Minfied Error #"+n+"\n")+p+n)).name="Graphcache Error",e}var y=function(e,t){return t?e+"("+n.stringifyVariables(t)+")":e},h=function(e){var t=e.indexOf("(");return-1<t?{fieldKey:e,fieldName:e.slice(0,t),arguments:JSON.parse(e.slice(t+1,-1))}:{fieldKey:e,fieldName:e,arguments:null}},m=function(e,t){return e+"."+t},g=function(e,t){return e+"|"+t},b="undefined"!=typeof Promise?Promise.prototype.then.bind(Promise.resolve()):function(e){return setTimeout(e,0)},k=function(){return e.observable({})},S=null,_=null,T=null,N=function(){return{optimistic:k(),base:new Map,keys:[]}},x=function(e,t){window.currentData=S=e,_=new Set,T=t},K=function(){var e=S;!e.gcScheduled&&0<e.gcBatch.size&&(e.gcScheduled=!0,b((function(){I(e)}))),e.storage&&!e.persistenceScheduled&&(e.persistenceScheduled=!0,b((function(){e.storage.write(e.persistenceBatch),e.persistenceScheduled=!1,e.persistenceBatch=k()}))),T=_=S=null},w=function(){return v(null!==_,"",2),_},q=function(e,t,n,r){T?(void 0===e.optimistic[T]&&(e.optimistic[T]=new Map,e.keys.unshift(T)),e=e.optimistic[T]):e=e.base;var i=e.get(t);void 0===i&&e.set(t,i=k()),void 0!==r||T?i[n]=r:delete i[n]},F=function(e,t,n){for(var r=0,i=e.keys.length;r<i;r++){var o=e.optimistic[e.keys[r]].get(t);if(void 0!==o&&n in o)return o[n]}return void 0!==(e=e.base.get(t))?e[n]:void 0},E=function(e,t){var n=e.keys.indexOf(t);-1<n&&(delete e.optimistic[t],e.keys.splice(n,1))},O=function(e,t,n,r){var i=void 0!==t[n]?t[n]:0;t=t[n]=i+r|0,void 0!==e&&(0>=t?e.add(n):0>=i&&0<t&&e.delete(n))},A=function(e,t,n,r){if("string"==typeof n)O(e,t,n,r);else if(Array.isArray(n))for(var i=0,o=n.length;i<o;i++){var a=n[i];a&&O(e,t,a,r)}},P=function(e,t,n){if(void 0!==n)for(var r in n)t.has(r)||(e.push(h(r)),t.add(r))},R=function(e,t,n,r){P(e,t,r.base.get(n));for(var i=0,o=r.keys.length;i<o;i++)P(e,t,r.optimistic[r.keys[i]].get(n))},I=function(e){e.gcScheduled=!1,e.gcBatch.forEach((function(t){if(0>=(e.refCount[t]||0)){for(var n in e.refLock){var r=e.refLock[n];if(0<(r[t]||0))return;delete r[t]}if(delete e.refCount[t],e.gcBatch.delete(t),void 0!==(n=e.records.base.get(t))&&(e.records.base.delete(t),e.storage))for(var i in n)n=g("r",m(t,i)),e.persistenceBatch[n]=void 0;if(void 0!==(i=e.links.base.get(t)))for(var o in e.links.base.delete(t),i)e.storage&&(n=g("l",m(t,o)),e.persistenceBatch[n]=void 0),A(e.gcBatch,e.refCount,i[o],-1)}else e.gcBatch.delete(t)}))},M=function(e,t){"__typename"!==t&&(e!==S.queryRootKey?_.add(e):void 0!==t&&_.add(m(e,t)))},L=function(e,t){return M(e,t),F(S.records,e,t)},B=function(e,t){return M(e,t),F(S.links,e,t)},D=function(e,t,n){M(e,t),q(S.records,e,t,n),S.storage&&!T&&(e=g("r",m(e,t)),S.persistenceBatch[e]=n)},C=function(e,t,n){var r=S;if(T)var i=r.refLock[T]||(r.refLock[T]=k()),o=r.links.optimistic[T];else{r.storage&&(i=g("l",m(e,t)),r.persistenceBatch[i]=n),i=r.refCount,o=r.links.base;var a=r.gcBatch}o=void 0!==(o=void 0!==o?o.get(e):void 0)?o[t]:null,M(e,t),q(r.links,e,t,n),A(a,i,o,-1),A(a,i,n,1)},Q=function(e,t,n,r){return!(!t||t!==c(e)&&u(e).some((function(e){return!!l(e)&&(e=y(o(e),ee(e,r.variables)),!function(e,t){return void 0!==L(e,t)||void 0!==B(e,t)}(n,e))})))},j=function(e,t,n,r){this.typename=e,this.entityKey=t,this.context=r,this.indexStack=[0],this.selectionStack=[n]};j.prototype.next=function(){for(;0!==this.indexStack.length;){var e=this.indexStack[this.indexStack.length-1]++,t=this.selectionStack[this.selectionStack.length-1];if(e>=t.length)this.indexStack.pop(),this.selectionStack.pop();else if(le(e=t[e],this.context.variables))if(l(e)){if("__typename"!==o(e))return e}else void 0!==(e=f(e)?e:this.context.fragments[o(e)])&&(void 0!==this.context.schemaPredicates?this.context.schemaPredicates.isInterfaceOfType(c(e),this.typename):Q(e,this.typename,this.entityKey,this.context))&&(this.indexStack.push(0),this.selectionStack.push(u(e)))}};var G=function(e){return void 0===e?null:e},W=function(e,t,n){return x(e.data,0),e=U(e,t,n),K(),e},U=function(e,t,n){var r=se(t.query),i={dependencies:w()},o=u(r),a=e.getRootKey(r.operation);return a===(e={parentTypeName:a,parentKey:a,parentFieldKey:"",fieldName:"",variables:te(r,t.variables),fragments:ce(t.query),result:i,store:e,schemaPredicates:e.schemaPredicates}).store.getRootKey("query")?J(e,a,o,n):H(e,a,o,n),i},V=function(e,t,n){x(e.data,n);var r=se(t.query);n={dependencies:w()};var i,a=e.getRootKey("mutation"),s=e.getRootKey(r.operation);for(v(s===a,"",10),e={parentTypeName:a,parentKey:a,parentFieldKey:"",fieldName:"",variables:te(r,t.variables),fragments:ce(t.query),result:n,store:e,schemaPredicates:e.schemaPredicates,optimistic:!0},t=k(),r=new j(s,s,u(r),e);void 0!==(i=r.next());)if(void 0!==i.selectionSet){var c=o(i),l=e.store.optimisticMutations[c];if(void 0!==l){e.fieldName=c,l=l((s=ee(i,e.variables))||k(),e.store,e);var f=G(l);X(e,f,u(i)),t[c]=l,void 0!==(i=e.store.updates[a][c])&&i(t,s||k(),e.store,e)}}return K(),n},z=function(e,t,n,r){t=ce(t);var o=Object.keys(t);if(void 0!==(o=t[o[0]])){var s=a(o);n=i({__typename:s},n);var c=e.keyOfEntity(n);c&&(e={parentTypeName:s,parentKey:c,parentFieldKey:"",fieldName:"",variables:r||{},fragments:t,result:{dependencies:w()},store:e,schemaPredicates:e.schemaPredicates},J(e,c,u(o),n))}},J=function(e,t,n,r){var i=t===e.store.getRootKey("query")?t:r.__typename;if("string"==typeof i)for(D(t,"__typename",i),n=new j(i,t,n,e);void 0!==(i=n.next());){var a=o(i),c=ee(i,e.variables);a=y(a,c);var l=r[s(i)];c=m(t,a),void 0===i.selectionSet?D(t,a,l):(l=G(l),i=Y(e,c,u(i),l),C(t,a,i))}},Y=function(e,t,n,r){if(Array.isArray(r)){for(var i=Array(r.length),o=0,a=r.length;o<a;o++){var s=r[o],u=m(t,""+o);s=Y(e,u,n,s),i[o]=s}return i}return null===r?null:(t=null!==(i=e.store.keyOfEntity(r))?i:t,o=r.__typename,void 0!==e.store.keys[r.__typename]||null!==i||"string"!=typeof o||o.endsWith("Connection")||o.endsWith("Edge"),J(e,t,n,r),t)},H=function(e,t,n,r){var i,a=t===e.store.getRootKey("mutation")||t===e.store.getRootKey("subscription");for(n=new j(t,t,n,e);void 0!==(i=n.next());){var c=o(i),l=ee(i,e.variables),f=m(t,y(c,l));if(void 0!==i.selectionSet){var d=G(r[s(i)]);X(e,d,u(i))}a&&(e.parentTypeName=t,e.parentKey=t,e.parentFieldKey=f,e.fieldName=c,void 0!==(i=e.store.updates[t][c])&&i(r,l||k(),e.store,e))}},X=function(e,t,n){if(Array.isArray(t)){for(var r=Array(t.length),i=0,o=t.length;i<o;i++)r[i]=X(e,t[i],n);return r}null!==t&&(null!==(r=e.store.keyOfEntity(t))?J(e,r,n,t):H(e,t.__typename,n,t))},Z=function(e,t,n){if("Query"!==t){var r=L(t,"__typename");if("string"!=typeof r)return;D(t,"__typename",void 0)}else r=t;for(n=new j(r,t,n,e);void 0!==(r=n.next());){var i=o(r),a=y(i,ee(r,e.variables));if(void 0===r.selectionSet)D(t,a,void 0);else if(r=u(r),i=B(t,a),C(t,a,void 0),D(t,a,void 0),Array.isArray(i)){a=0;for(var s=i.length;a<s;a++){var c=i[a];null!==c&&Z(e,c,r)}}else i&&Z(e,i,r)}},$=function(e,t,n,r,i){var o,a=this;this.gcScheduled=!1,this.gc=function(){I(a.data),a.gcScheduled=!1},this.keyOfField=y,this.resolvers=t||{},this.optimisticMutations=r||{},this.keys=i||{},this.schemaPredicates=e,this.updates={Mutation:n&&n.Mutation||{},Subscription:n&&n.Subscription||{}},e?(n=(t=e.schema).getQueryType(),e=t.getMutationType(),t=t.getSubscriptionType(),this.rootFields={query:n=n?n.name:"Query",mutation:e=e?e.name:"Mutation",subscription:t=t?t.name:"Subscription"},this.rootNames=((o={})[n]="query",o[e]="mutation",o[t]="subscription",o)):(this.rootFields={query:"Query",mutation:"Mutation",subscription:"Subscription"},this.rootNames={Query:"query",Mutation:"mutation",Subscription:"subscription"}),this.data=function(e){return{persistenceScheduled:!1,persistenceBatch:k(),gcScheduled:!1,queryRootKey:e,gcBatch:new Set,refCount:k(),refLock:k(),links:N(),records:N(),storage:null}}(this.getRootKey("query"))};$.prototype.getRootKey=function(e){return this.rootFields[e]},$.prototype.keyOfEntity=function(e){var t,n=e.__typename,r=e.id,i=e._id;return n?void 0!==this.rootNames[n]?n:(this.keys[n]?t=this.keys[n](e):null!=r?t=""+r:null!=i&&(t=""+i),t?n+":"+t:null):null},$.prototype.resolveFieldByKey=function(e,t){if(null===(e=null!==e&&"string"!=typeof e?this.keyOfEntity(e):e))return null;var n=L(e,t);return void 0!==n?n:(t=B(e,t))?t:null},$.prototype.resolve=function(e,t,n){return this.resolveFieldByKey(e,y(t,n))},$.prototype.invalidateQuery=function(e,t){!function(e,t){var n=se(t.query);e={variables:te(n,t.variables),fragments:ce(t.query),store:e,schemaPredicates:e.schemaPredicates},Z(e,e.store.getRootKey("query"),u(n))}(this,n.createRequest(e,t))},$.prototype.inspectFields=function(e){return null!==(e=null!==e&&"string"!=typeof e?this.keyOfEntity(e):e)?function(e){var t=S.links,n=S.records,r=[],i=new Set;return M(e),R(r,i,e,t),R(r,i,e,n),r}(e):[]},$.prototype.updateQuery=function(e,t){e=n.createRequest(e.query,e.variables),null!==(t=t(this.readQuery(e)))&&U(this,e,t)},$.prototype.readQuery=function(e){return de(this,n.createRequest(e.query,e.variables)).data},$.prototype.readFragment=function(e,t,n){return ye(this,e,t,n)},$.prototype.writeFragment=function(e,t,n){z(this,e,t,n)};var ee=function(e,n){if(void 0===e.arguments||0===e.arguments.length)return null;for(var r=k(),i=0,a=0,s=e.arguments.length;a<s;a++){var u=e.arguments[a],c=t.valueFromASTUntyped(u.value,n);null!=c&&(r[o(u)]=c,i++)}return 0<i?r:null},te=function(e,n){if(void 0===e.variableDefinitions)return{};var r=n||{};return e.variableDefinitions.reduce((function(e,n){var i=o(n.variable),a=r[i];if(void 0===a){if(void 0===n.defaultValue)return e;a=t.valueFromASTUntyped(n.defaultValue,r)}return e[i]=a,e}),k())},ne=function(e){this.schema=t.buildClientSchema(e)};ne.prototype.isFieldNullable=function(e,n){return void 0!==(e=re(this.schema,e,n))&&t.isNullableType(e.type)},ne.prototype.isListNullable=function(e,n){return void 0!==(e=re(this.schema,e,n))&&(e=t.isNonNullType(e.type)?e.type.ofType:e.type,t.isListType(e)&&t.isNullableType(e.ofType))},ne.prototype.isFieldAvailableOnType=function(e,t){return!!re(this.schema,e,t)},ne.prototype.isInterfaceOfType=function(e,n){return!(!n||!e)&&(n===e||(e=this.schema.getType(e),n=this.schema.getType(n),e instanceof t.GraphQLObjectType?e===n:(function(e,n){v(e instanceof t.GraphQLInterfaceType||e instanceof t.GraphQLUnionType,"",5)}(e),ie(n),this.schema.isPossibleType(e,n))))};var re=function(e,t,n){if(ie(e=e.getType(t)),void 0!==(n=e.getFields()[n]))return n};function ie(e,n){v(e instanceof t.GraphQLObjectType,"",3)}var oe=function(e){return e.kind===t.Kind.FRAGMENT_DEFINITION};function ae(e){return e.kind===t.Kind.OPERATION_DEFINITION}var se=function(e){return v(!!(e=e.definitions.find(ae)),"",1),e};function ue(e,t){return e[o(t)]=t,e}var ce=function(e){return e.definitions.filter(oe).reduce(ue,{})},le=function(e,n){if(void 0===(e=e.directives))return!0;for(var r=0,i=e.length;r<i;r++){var a=e[r],s=o(a),u="include"===s;if((u||"skip"===s)&&(a=a.arguments?a.arguments[0]:null)&&"if"===o(a)&&("boolean"==typeof(a=t.valueFromASTUntyped(a.value,n))||null===a))return u?!!a:!a}return!0},fe=function(e,t,n){return x(e.data,0),de(e,t,n)},de=function(e,t,n){var r=se(t.query),i=e.getRootKey(r.operation),o=u(r);return e={parentTypeName:i,parentKey:i,parentFieldKey:"",fieldName:"",variables:te(r,t.variables),fragments:ce(t.query),partial:!1,store:e,schemaPredicates:e.schemaPredicates},n=n||k(),n=i!==e.store.getRootKey("query")?pe(e,i,o,n):he(e,i,o,n),{dependencies:w(),partial:void 0!==n&&e.partial,data:void 0===n?null:n}},pe=function(e,t,n,r){if("string"!=typeof r.__typename)return r;t=new j(t,t,n,e),(n=k()).__typename=r.__typename;for(var i;void 0!==(i=t.next());){var o=s(i),a=r[o];void 0!==i.selectionSet&&null!==a?(a=G(a),n[o]=ve(e,u(i),a)):n[o]=a}return n},ve=function(e,t,n){if(Array.isArray(n)){for(var r=Array(n.length),i=0,o=n.length;i<o;i++)r[i]=ve(e,t,n[i]);return r}return null===n?null:null!==(r=e.store.keyOfEntity(n))?void 0===(e=he(e,r,t,k()))?null:e:pe(e,n.__typename,t,n)},ye=function(e,t,n,r){t=ce(t);var o=Object.keys(t);if(void 0===(o=t[o[0]]))return null;var s=a(o);return"string"==typeof n||n.__typename||(n.__typename=s),(n="string"!=typeof n?e.keyOfEntity(i({__typename:s},n)):n)&&he({parentTypeName:s,parentKey:n,parentFieldKey:"",fieldName:"",variables:r||{},fragments:t,partial:!1,store:e,schemaPredicates:e.schemaPredicates},n,u(o),k())||null},he=e.action((function(e,t,n,r){var i=e.store,a=e.schemaPredicates,c=t===i.getRootKey("query"),l=c?t:L(t,"__typename");if("string"==typeof l){r.__typename=l,n=new j(l,t,n,e);for(var f,d=!1,p=!1,v=function(){var n=o(f),c=ee(f,e.variables),v=s(f),h=y(n,c),g=L(t,h),b=function(e,t){return M(e,t),function(e,t,n){for(var r=0,i=e.keys.length;r<i;r++){var o=e.optimistic[e.keys[r]].get(t);if(void 0!==o&&n in o)return o}return void 0!==(e=e.base.get(t))?e:void 0}(S.records,e,t)}(t,h),_=m(t,h),T=!1,N=void 0,x=i.resolvers[l];if(void 0!==x&&"function"==typeof x[n]){if(e.parentTypeName=l,e.parentKey=t,e.parentFieldKey=_,e.fieldName=n,void 0!==g&&(r[v]=g),N=x[n](r,c||k(),i,e),void 0!==f.selectionSet&&(N=me(e,l,n,_,u(f),r[v]||k(),N)),void 0!==a&&null===N&&!a.isFieldNullable(l,n))return{v:void 0}}else if(void 0===f.selectionSet)N=g,T=!0,void 0===r[v]&&Object.defineProperty(r,v,{get:function(){return null!=b?b[v]:void 0}});else if(void 0!==(c=B(t,h))){if(N=ge(e,c,l,n,u(f),r[v]),void 0===r[v]){T=!0;var K=f,w=l;Object.defineProperty(r,v,{get:function(){var r=B(t,h);if(r)return null!=(r=ge(e,r,w,n,u(K),void 0))?r:void 0}})}}else"object"==typeof g&&null!==g&&(N=g);if(void 0===N&&void 0!==a&&a.isFieldNullable(l,n))p=!0,r[v]=null;else{if(void 0===N)return{v:void 0};d=!0,!1===T&&(r[v]=N)}};void 0!==(f=n.next());){var h=v();if(h)return h.v}return p&&(e.partial=!0),c&&p&&!d?void 0:r}})),me=function(e,t,n,r,i,a,c){if(Array.isArray(c)){var l=e.schemaPredicates;l=void 0===l||l.isListNullable(t,n);for(var f=Array(c.length),d=0,p=c.length;d<p;d++){var v=me(e,t,n,m(r,""+d),i,void 0!==a?a[d]:void 0,c[d]);if(void 0===v&&!l)return;f[d]=void 0!==v?v:null}return f}return null==c?c:be(c)?(t=void 0===a?k():a,"string"==typeof c?he(e,c,i,t):function(e,t,n,r,i){var a=e.schemaPredicates;t=e.store.keyOfEntity(i)||t;var c=i.__typename,l=L(t,"__typename")||c;if(!("string"!=typeof l||c&&l!==c)){r.__typename=l,n=new j(l,t,n,e);for(var f=!1,d=!1;void 0!==(c=n.next());){var p=o(c),v=s(c),h=y(p,ee(c,e.variables)),g=m(t,h),b=L(t,h),k=i[p],S=void 0;if(void 0!==k&&void 0===c.selectionSet?S=k:void 0===c.selectionSet?S=b:void 0!==k?S=me(e,l,p,g,u(c),r[v],k):void 0!==(h=B(t,h))?S=ge(e,h,l,p,u(c),r[v]):"object"==typeof b&&null!==b&&(S=b),void 0===S&&void 0!==a&&a.isFieldNullable(l,p))d=!0,r[v]=null;else{if(void 0===S)return;f=!0,r[v]=S}}return d&&(e.partial=!0),f?r:void 0}}(e,r,i,t,c)):void 0},ge=function(e,t,n,r,i,o){if(Array.isArray(t)){var a=e.schemaPredicates;a=void 0!==a&&a.isListNullable(n,r);for(var s=Array(t.length),u=0,c=t.length;u<c;u++){var l=ge(e,t[u],n,r,i,void 0!==o?o[u]:void 0);if(void 0===l&&!a)return;s[u]=void 0!==l?l:null}return s}return null===t?null:he(e,t,i,void 0===o?k():o)},be=function(e){return"string"==typeof e||"object"==typeof e&&"string"==typeof e.__typename},ke=function(e,t){return i(i({},e),{context:i(i({},e.context),{meta:i(i({},e.context.meta),{cacheOutcome:t})})})},Se=function(e){return i(i({},e),{query:n.formatDocument(e.query)})},_e=function(e){return e.context.requestPolicy},Te=function(e){return"query"===e.operationName},Ne=function(e){return Te(e)&&"network-only"!==_e(e)},xe=function(e,t){return i(i({},e),{context:i(i({},e.context),{requestPolicy:t})})};function Ke(e){return Ne(e)}function we(e){return ke(e.operation,e.outcome)}function qe(e){return"miss"===e.outcome}function Fe(e){return"miss"!==e.outcome}function Ee(e){return!Ne(e)}function Oe(e){return"populate"!==o(e)}function Ae(e,t){return"FragmentDefinition"===t.kind&&e.add(t.name.value),e}var Pe=function(e,n,r,a){function s(e,n){if(!(n=r[n.name]))return e;for(var i=0,s=n.length;i<s;i++){for(var u=n[i].fragment,c=o(u),p=Me(u),v=0,y=p.length;v<y;v++){var h=p[v];d.has(h)||(l[h]=a[h])}f[c]=u,e.push({kind:t.Kind.FRAGMENT_SPREAD,name:Re(c)})}return e}var c=new t.TypeInfo(e),l=k(),f=k(),d=new Set;return t.visit(n,t.visitWithTypeInfo(c,{Field:{enter:function(n){if(n.directives){var r=n.directives.filter(Oe);if(r.length!==n.directives.length){var o=Ie(e,c).reduce(s,[]),a=u(n);return o=0!==a.length+o.length?o.concat(a):[{kind:t.Kind.FIELD,name:Re("__typename")}],i(i({},n),{directives:r,selectionSet:{kind:t.Kind.SELECTION_SET,selections:o}})}}}},Document:{enter:function(e){e.definitions.reduce(Ae,d)},leave:function(e){var t,n=[].concat(e.definitions);for(t in f)n.push(f[t]);for(var r in l)n.push(l[r]);return i(i({},e),{definitions:n})}}}))},Re=function(e){return{kind:t.Kind.NAME,value:e}},Ie=function(e,n){return n=d(n.getType()),t.isCompositeType(n)?t.isAbstractType(n)?e.getPossibleTypes(n):[n]:[]},Me=function(e){var n=[];return t.visit(e,{FragmentSpread:function(e){n.push(o(e))}}),n};exports.Store=$,exports.cacheExchange=function(e){return function(t){function n(e){var t=e.operation,n=e.outcome,r=_e(t);return e={operation:ke(t,n),data:e.data,error:e.error,extensions:e.extensions},("cache-and-network"===r||"cache-first"===r&&"partial"===n)&&(e.stale=!0,o.reexecuteOperation(xe(t,"network-only"))),e}var i=t.forward,o=t.client;e||(e={});var a=new $(e.schema?new ne(e.schema):void 0,e.resolvers,e.updates,e.optimistic,e.keys);if(e.storage)var s=e.storage,u=s.read().then((function(e){!function(e,t,n){for(var r in x(e,0),n){var i=r.indexOf("."),o=r.slice(2,i);switch(i=r.slice(i+1),r.charCodeAt(0)){case 108:C(o,i,n[r]);break;case 114:D(o,i,n[r])}}K(),e.storage=t}(a.data,s,e)}));var c=new Map,l=new Map,f=k(),d=function(e,t){void 0!==t&&t.forEach((function(t){var n=f[t];if(void 0!==n){f[t]=[],t=0;for(var r=n.length;t<r;t++)e.add(n[t])}}))},p=function(e,t){t.forEach((function(t){if(t!==e.key){var n=l.get(t);void 0!==n&&(l.delete(t),o.reexecuteOperation(xe(n,"cache-first")))}}))},v=function(e){if(function(e){return function(e){return"mutation"===e.operationName}(e)&&"network-only"!==_e(e)}(e)){var t=e.key,n=V(a,e,t).dependencies;0!==n.size&&(c.set(t,n),t=new Set,d(t,n),p(e,t))}},y=function(e,t){t.forEach((function(t){(f[t]||(f[t]=[])).push(e.key),l.has(e.key)||l.set(e.key,"network-only"===_e(e)?xe(e,"cache-and-network"):e)}))},h=function(e){var t=fe(a,e),n=t.data,r=t.dependencies;return t=t.partial,null===n?r="miss":(y(e,r),r=t&&"cache-only"!==_e(e)?"partial":"hit"),{outcome:r,operation:e,data:n}},m=function(e){var t=e.operation,n=e.error,r=e.extensions,i=Te(t),o=e.data,s=t.key,u=new Set;if(d(u,c.get(s)),c.delete(s),function(e,t){delete e.refLock[t],E(e.records,t),E(e.links,t)}(a.data,s),null!=o){var l=W(a,t,o).dependencies;if(i){o=(s=fe(a,t)).data;var f=s.dependencies}else o=fe(a,t,o).data}return d(u,l),i&&d(u,f),p(e.operation,u),i&&void 0!==f&&y(e.operation,f),{data:o,error:n,extensions:r,operation:t}};return function(e){e=r.share(e);var t=u?r.mergeMap(r.fromArray)(r.take(1)(r.buffer(r.fromPromise(u))(e))):r.empty;e=r.share(r.tap(v)(r.map(Se)(r.concat([t,e]))));var o=r.share(r.map(h)(r.filter(Ke)(e)));return t=r.map(we)(r.filter(qe)(o)),o=r.map(n)(r.filter(Fe)(o)),e=r.map(m)(i(r.merge([r.filter(Ee)(e),t]))),r.merge([e,o])}}},exports.clearDataState=K,exports.initDataState=x,exports.populateExchange=function(e){var n=e.schema;return function(e){function a(e){return l.has(e.key)}var s=e.forward,u=t.buildClientSchema(n),c=new Set,l=new Set,f=k(),p=k(),y=function(e){if("mutation"!==e.operationName)return e;var t,n=k();for(t in p)n[t]=p[t].filter(a);return i(i({},e),{query:Pe(u,e.query,n,f)})},h=function(e){var n=e.key,r=e.query;if("query"===e.operationName&&(l.add(n),!c.has(n))){c.add(n),r=(e=function(e,n){var r=[],i=[],o=new t.TypeInfo(e);return t.visit(n,t.visitWithTypeInfo(o,{Field:function(e){if(e.selectionSet){var n=function(e){return v((e=d(e.getType()))&&!t.isAbstractType(e),"",18),e.toString()}(o);i.push({kind:t.Kind.FRAGMENT_DEFINITION,typeCondition:{kind:t.Kind.NAMED_TYPE,name:Re(n)},name:Re(n+"_PopulateFragment_"),selectionSet:e.selectionSet})}},FragmentDefinition:function(e){r.push(e)}})),[r,i]}(u,r))[0],e=e[1];for(var i=0,a=r.length;i<a;i++){var s=r[i];f[o(s)]=s}for(r=0,i=e.length;r<i;r++)s=o((a=e[r]).typeCondition),s=p[s]||(p[s]=[]),a.name.value+=s.length,s.push({key:n,fragment:a})}},m=function(e){"teardown"===e.operationName&&l.delete(e.key)};return function(e){return s(r.map(y)(r.tap(m)(r.tap(h)(e))))}}},exports.query=fe,exports.read=de,exports.write=W,exports.writeFragment=z,exports.writeOptimistic=V;
